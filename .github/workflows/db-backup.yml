on:
  push:

jobs:

  backup:
    runs-on: ubuntu-latest
    steps:
      -
        uses: actions/checkout@v2
      -
        name: Put server's SSH key
        uses: ./.github/actions/ssh-keys
        with:
          action: put
          identity: ${{ secrets.deploy_target_identity }}
          key: ${{ secrets.deploy_target_key }}
      -
        name: Backup
        shell: bash
        run: |
          ssh -T ci@$DEPLOY_TARGET_HOST -p $DEPLOY_TARGET_PORT << 'EOF'
            echo "hello from"
            hostname
          EOF
        env:
          DEPLOY_TARGET_HOST: ${{ secrets.deploy_target_host }}
          DEPLOY_TARGET_PORT: ${{ secrets.deploy_target_port }}
      -
        name: Destroy server's SSH key
        uses: ./.github/actions/ssh-keys
        with:
          action: destroy
